<!doctype html>
<html>
	<head>
		<title>ATM Locator</title>
		<meta name="viewport" content="width=device-width, initial-scale=1"> 
		<link rel="stylesheet" href="style.css"/>
		<script src="jquery-1.8.2.min.js"></script>
		<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
		<script>
			var directionsDisplay;
			var directionsService = new google.maps.DirectionsService();
			var map;
			
			function initialize(lat,lng, latend,lngend) {
			  directionsDisplay = new google.maps.DirectionsRenderer();
			  var chicago = new google.maps.LatLng(-3.688855,116.705017);
			  var mapOptions = {
				zoom:12,
				mapTypeId: google.maps.MapTypeId.ROADMAP,
				center: chicago
			  }
			  map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
			  directionsDisplay.setMap(map);
			  
			  var start = new google.maps.LatLng(lat, lng);
			  var end = new google.maps.LatLng(latend, lngend);
			  var request = {
				  origin:start,
				  destination:end,
				  travelMode: google.maps.DirectionsTravelMode.WALKING
			  };
			  directionsService.route(request, function(response, status) {
				if (status == google.maps.DirectionsStatus.OK) {
				  directionsDisplay.setDirections(response);
				}
			  });
			}
			
			function quickfind(){
				alert("1");
				var content = "";
				$("#maincontent").html("");
				if (navigator.geolocation){
					alert("2")
					navigator.geolocation.getCurrentPosition(function(position){
						alert("3");
						$.getJSON("http://locator.chasan.web.id/atm.php?lat="+position.coords.latitude+"&lng="+position.coords.longitude+"&bank=none",function(data){
							alert("4")
							content +=   '<table width="100%" height="100%">'+
											'<tr>'+
												'<td height="50%">'+
													'<div id="map-canvas"></div>'+
												'</td>'+
											'</tr>'+
											'<tr>'+
												'<td height="50%">'+
													'<div id="links" style="overflow-y: scroll; height:100%;">'+
														'<ul>';
							
							$.each(data.atm, function(i,atm){
								content += '<li><a href="#" title="Text" onclick="initialize('+position.coords.latitude+','+position.coords.longitude+','+atm.lat+','+atm.lng+')">'+
													'<em>ATM '+atm.bank+' '+atm.nama+'</em>'+
													'<span>'+atm.alamat+'</span></a></li>';
							});
							content += 					'</ul>'+
													'</div>'+
												'</td>'+
											'</tr>'+
										'</table>';
							$("#maincontent").html(content);
							
							initialize(position.coords.latitude,position.coords.longitude,data.atm[0].lat,data.atm[0].lng);
						});
					})
				}
			}
		</script>
	</head>
<body bgcolor="#157A4E" style="margin: 0px;" onload="onLoad()">
<div id="maincontent" style="width: 100%; height: 100%">
	<table border="0" cellpadding="0" cellspacing="0"  width="100%" height="100%">
		<tr>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td align="center" valign="middle"><img src="img/logo.png"></td>
		</tr>
		<tr>
			<td align="center" valign="bottom">
				<table border="0" cellpadding="0" cellspacing="0" width="308">
					<tr>
						<td onclick=""><img name="logo_r1_c1" src="img/logo_r1_c1.png" width="100" height="83" border="0" id="logo_r1_c1" alt="" /></td>
						<td onclick="quickfind()"><img name="logo_r1_c2" src="img/logo_r1_c2.png" width="106" height="83" border="0" id="logo_r1_c2" alt="" /></td>
						<td><img name="logo_r1_c3" src="img/logo_r1_c3.png" width="102" height="83" border="0" id="logo_r1_c3" alt="" /></td>
						<td><img src="img/spacer.gif" width="1" height="83" border="0" alt="" /></td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
</div>
</body>
</html>